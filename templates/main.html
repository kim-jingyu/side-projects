<!DOCTYPE html>
<html lang="en">
    <head>
        <title>
            Login
        </title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="이 페이지는 Jinja2와 서버사이드 렌더링에 대한 정보를 제공합니다.">
        <meta name="keywords" content="Jinja2, 서버사이드 렌더링, 웹 개발, 템플릿 엔진">
        <!-- Tailwind CSS CDN -->
        <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    </head>

    <body class="bg-gray-100 h-screen flex flex-col justify-center items-center">

        <h1 class="text-4xl font-bold mb-4">KRAFTTO</h1>

        <div class="bg-white p-8 rounded-lg shadow-md w-1/2 relative">

            <!-- Username and Logout Button -->
            <div class="absolute top-4 right-4 flex items-center">
                <span class="text-xl mr-4">{{ username }}</span>
                <a href="{{ url_for('login.login_func') }}" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">로그아웃</a>
            </div>

            {% if user == None %}
            <h3 class="text-2xl font-semibold mb-4">
                당신은 아직 마니또가 없습니다. 룰렛을 돌려주세요.
            </h3>
            <div class="border rounded p-4 mt-4 flex justify-center items-center">
                <button class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"onclick = "openSlotMachine()">룰렛 돌리기</button>
            </div>

            <!-- Modal -->
            <div id="slotMachineModal" class="hidden fixed top-0 left-0 w-full h-full flex justify-center items-center bg-black bg-opacity-50">
                <div class="bg-white p-8 rounded-lg">
                    <h2 class="text-2xl mb-4">슬롯 머신을 돌려주세요!</h2>
                    <div id="slotMachine" class="flex justify-center">
                        <div class="slot">
                            <!-- 미션들을 여기에 배치합니다. -->
                            1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16
                        </div>
                    </div>
                    <button id="spinButton" class="mt-4 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">돌리기</button>
                </div>
            </div>
            <!-- Trigger Modal -->
            <button onclick="openSlotMachine()">슬롯 머신 돌리기</button>
            {% else %}


            <h3 class="text-2xl font-semibold mb-4">
                당신은 {{ user.person_i_help }}의 마니또입니다.
            </h3>
    
                <!-- 게이지 바 -->
                <div class="border rounded p-4 mt-4">
                    <p>미션완료 게이지</p>
                    <div class="bg-gray-300 h-5 rounded-full mb-6">
                        <div class="h-full bg-blue-500 rounded-full"></div>
                    </div>
                    <!-- 퍼센트를 문자열로 표시 -->
                    <p class="text-center">
                        {% if week4_approved %}
                        100%
                        {% elif week3_approved %}
                        75%
                        {% elif week2_approved %}
                        50%
                        {% elif week1_approved %}
                        25%
                        {% else %}
                        0%
                        {% endif %}
                    </p>
                </div>
            {% endif %}

            <h3 class="text-2xl font-semibold mb-4">미션 확인</h3>

            <div class="border rounded p-4 mt-4 text-center space-y-4">
                {% if week1_approved %}
                <a class="block bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 w-full text-center" href="{{ url_for('mission_complete.mission_complete_fun', weeknumber=1) }}">
                    1주차 보상
                </a>
                {% else %}
                <a class="block bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 w-full text-center" href="{{ url_for('mission.mission_func', weeknumber=1) }}">
                        1주차 미션
                </a>  
                    {% endif %}
                {% if week1_approved %}
                    {% if week2_approved %}
                    <a class="block bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 w-full text-center" href="{{ url_for('mission_complete.mission_complete_fun', weeknumber=2) }}">
                    2주차 보상
                    </a>
                    {% else %}
                    <a class="block bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 w-full text-center" href="{{ url_for('mission.mission_func', weeknumber=2) }}">
                    2주차 미션
                    </a>
                    {% endif %}
                
                {% else %}
                <a class="block bg-gray-400 text-white px-4 py-2 rounded w-full text-center" href="#" onclick="return false;">2주차 미션</a>
                {% endif %}
        
                {% if week2_approved %}
                    {% if week3_approved %}
                    <a class="block bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 w-full text-center" href="{{ url_for('mission_complete.mission_complete_fun', weeknumber=3) }}">
                    3주차 보상
                    </a>
                    {% else %}
                    <a class="block bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 w-full text-center" href="{{ url_for('mission.mission_func', weeknumber=3) }}">
                        3주차 미션
                    </a>
                    {% endif %}
                </a>
                {% else %}
                <a class="block bg-gray-400 text-white px-4 py-2 rounded w-full text-center" href="#" onclick="return false;">3주차 미션</a>
                {% endif %}
        
                {% if week3_approved %}
                    {% if week4_approved %}
                    <a class="block bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 w-full text-center" href="{{ url_for('mission_complete.mission_final_complete_fun', weeknumber=4) }}">
                    4주차 보상
                    </a>
                    {% else %}
                    <a class="block bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 w-full text-center" href="{{ url_for('mission.mission_func', weeknumber=4) }}">
                        4주차 미션
                    </a>
                    {% endif %}
                </a>
                {% else %}
                <a class="block bg-gray-400 text-white px-4 py-2 rounded w-full text-center" href="#" onclick="return false;">4주차 미션</a>
                {% endif %}
            </div>
        </div>
        <script>
            let spinning = false;
        
            function openSlotMachine() {
                document.getElementById('slotMachineModal').classList.remove('hidden');
                startSpinning();
            }
        
            function startSpinning() {
                if (!spinning) {
                    spinning = true;
                    let slot = document.querySelector('.slot');
                    let randomTop = Math.floor(Math.random() * 150); // 무작위 위치를 계산합니다.
                    slot.style.top = `-${randomTop}px`;
        
                    document.getElementById('spinButton').innerText = "STOP";
                } else {
                    stopSpinning();
                }
            }
        
            function stopSpinning() {
                spinning = false;
                document.getElementById('spinButton').innerText = "돌리기";
            }
        
            document.getElementById('spinButton').addEventListener('click', startSpinning);
        </script>
    </body>

</html>

